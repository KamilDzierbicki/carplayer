<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CarPlayer - Watch Video</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="icons/favicon.svg" type="image/svg+xml" />
</head>

<body>
  <div id="setupScreen">
    <div class="app-nav">
      <a href="#" id="logoLink" class="app-brand">
        <img class="icon icon--md" src="icons/favicon.svg" alt="CarPlayer Logo" />
        CarPlayer
      </a>

      <div class="search-bar">
        <span class="icon icon--sm icon-mask icon-mask--search search-bar__icon" aria-hidden="true"></span>
        <form action="javascript:void(0);" class="search-bar__form">
          <input type="text" id="searchInput" name="video_search_query" autocomplete="on" placeholder="Search on YouTube"
            class="search-bar__input" />
        </form>
        <button class="field-clear field-clear--inline" id="clearSearchBtn" title="Clear Search" type="button">
          ✕
        </button>
      </div>

      <div class="app-nav__actions">
        <button class="btn btn--dark" id="btnOpenUrlModal">
          <span class="icon icon--sm icon-mask icon-mask--plus" aria-hidden="true"></span>
          Add Video
        </button>

        <button class="icon-btn" id="btnOpenSettings" title="Settings" type="button">
          <span class="icon icon--md icon-mask icon-mask--settings" aria-hidden="true"></span>
        </button>
      </div>
    </div>

    <div class="history-header" id="historyHeader">
      <h2 id="historyTitle" class="history-header__title">
        Recently Played
      </h2>
      <button id="btnClearHistory" class="icon-btn icon-btn--compact" type="button">
        Clear All History
      </button>
    </div>
    <div class="video-grid" id="historyItems">
      <!-- Tiles injected by JS -->
    </div>
  </div>

  <div class="modal" id="settingsModal">
    <div class="modal__content modal__content--settings">
      <button class="modal__close" data-close-modal="settingsModal" type="button" aria-label="Close settings modal">
        <span class="icon icon--md icon-mask icon-mask--close" aria-hidden="true"></span>
      </button>
      <h2 class="modal__title">Settings</h2>
      <p class="section-note">
        To enable YouTube functionality, you need a free API Key from
        <a href="https://rapidapi.com/ytjar/api/yt-api/pricing" target="_blank" rel="noopener noreferrer" class="link-accent">RapidAPI
          yt-api</a>
      </p>

      <div class="field field--api">
        <input type="text" id="apiKeyInput" autocomplete="off" class="field__input field__input--with-clear"
          placeholder="Paste your API Key here" />
        <button class="field-clear field-clear--absolute" id="clearApiKeyBtn" title="Clear API Key" type="button">
          ✕
        </button>
      </div>

      <button class="btn btn--primary btn--block" id="btnSaveSettings" type="button">Save API Key</button>

      <div class="quota" id="apiQuotaContainer">
        <div class="quota__header">
          <div class="quota__title">API Usage (Monthly) <span class="quota__text" id="apiQuotaText">0 / --</span></div>
        </div>
        <div class="quota__bar">
          <div class="quota__fill" id="apiQuotaFill"></div>
        </div>
      </div>

      <div class="steps">
        <div class="step">
          <div class="step__badge">1</div>
          <div class="step__content">
            <h3 class="step__title">Get API Key</h3>
            <p class="step__desc">
              Scan QR code to open RapidAPI on your phone, sign in, and
              generate a free API Key.
            </p>
            <div class="qr-panel" id="rapidApiQrcode"></div>
          </div>
        </div>

        <div class="step">
          <div class="step__badge">2</div>
          <div class="step__content">
            <h3 class="step__title">Scan QR below and paste key on your mobile</h3>
            <p class="step__desc">
              Paste API key into the field and tap
              <b>Send to Car</b>.
            </p>
            <div class="qr-panel" id="settingsMobileQrcode"></div>
          </div>
        </div>

        <div class="step">
          <div class="step__badge">3</div>
          <div class="step__content">
            <h3 class="step__title">Send to Car</h3>
            <p class="step__desc step__desc--spaced">
              Click button to share link to your vehicle, that will automatically import the API Key.
            </p>
            <button id="btnShareFlowSettings" class="btn btn--primary btn--share btn--block" type="button">
              <span class="icon icon--sm icon-mask icon-mask--share" aria-hidden="true"></span>
              Send API Key to Car
            </button>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <span>Made with &lt;3 from Poland by kamilmlody5</span>
        <a href="https://github.com/KamilDzierbicki/carplayer" target="_blank" rel="noopener noreferrer" class="link-github"
          title="View Source on GitHub">
          <span class="icon icon--lg icon-mask icon-mask--github" aria-hidden="true"></span>
        </a>
      </div>
    </div>
  </div>

  <div class="modal" id="mobileApiModal">
    <div class="modal__content">
      <button class="modal__close" data-close-modal="mobileApiModal" type="button"
        aria-label="Close send API Key to Car modal">
        <span class="icon icon--md icon-mask icon-mask--close" aria-hidden="true"></span>
      </button>
      <h2 class="modal__title">Send API Key to Car</h2>
      <div class="field">
        <input type="text" id="mobileApiInput" placeholder="Paste API Key here" class="field__input" />
      </div>
      <button class="btn btn--primary btn--share btn--block" id="btnShareApiFlow" type="button">
        <span class="icon icon--md icon--ink icon-mask icon-mask--share" aria-hidden="true"></span>
        Send to Car
      </button>
    </div>
  </div>

  <div class="modal" id="urlModal">
    <div class="modal__content">
      <button class="modal__close" data-close-modal="urlModal" type="button" aria-label="Close add video modal">
        <span class="icon icon--md icon-mask icon-mask--close" aria-hidden="true"></span>
      </button>
      <h2 class="modal__title">Add Video</h2>

      <div class="qr-flow">
        <div class="qr-card" id="qrcode"></div>
        <div class="step-list">
          <div class="step-list__title">How to play via phone:</div>

          <div class="step">
            <div class="step__badge">1</div>
            <p class="step__desc">Scan this QR code with your phone.</p>
          </div>

          <div class="step">
            <div class="step__badge">2</div>
            <p class="step__desc">Open the page and paste your video link.</p>
          </div>

          <div class="step">
            <div class="step__badge">3</div>
            <p class="step__desc">Tap "Send to Car" - it will play right here!</p>
          </div>
        </div>
      </div>

      <div class="field field--url">
        <input type="url" id="videoUrl" placeholder="Type Direct video URL (.mp4, direct YouTube URL)" value=""
          class="field__input field__input--with-clear" />
        <button class="field-clear field-clear--center" id="clearVideoUrlBtn" title="Clear URL" type="button">
          ✕
        </button>
      </div>
      <button class="btn btn--primary btn--block is-disabled" id="btnLoad" type="button">
        Play
      </button>
      <button class="btn btn--ghost btn--block" id="btnPlaySample" type="button">
        Or Play Sample Video
      </button>
    </div>
  </div>

  <div class="modal" id="shareAppModal">
    <div class="modal__content">
      <button class="modal__close" data-close-modal="shareAppModal" type="button" aria-label="Close share modal">
        <span class="icon icon--md icon-mask icon-mask--close" aria-hidden="true"></span>
      </button>
      <h2 class="modal__title">Send to Car</h2>
      <p class="section-note section-note--center">
        Paste a direct link to an MP4 file or a link from YouTube
      </p>
      <div class="field">
        <input type="url" id="shareVideoUrl" placeholder="Paste Direct Video URL here" class="field__input" />
      </div>
      <button class="btn btn--secondary btn--share btn--block" id="btnShareFlow" type="button">
        <span class="icon icon--md icon--ink icon-mask icon-mask--share" aria-hidden="true"></span>
        Send to Car
      </button>
    </div>
  </div>

  <div id="playerScreen">
    <div class="loader" id="loader"></div>

    <div id="mediaContainer">
      <canvas id="videoCanvas"></canvas>
      <div id="skipIndicator" class="skip-indicator"></div>
    </div>

    <div class="player-topbar" id="topBar">
      <button class="btn btn--glass btn--back" id="btnBack" type="button">
        <span class="icon icon--sm icon-mask icon-mask--back" aria-hidden="true"></span>
        Back
      </button>
      <div id="videoTitleOverlay" class="player-title"></div>
    </div>

    <video id="hiddenVideo" class="hidden" playsinline></video>

    <div class="player-controls" id="controls">
      <button class="icon-btn icon-btn--control" id="playPauseBtn" type="button">
        <span id="iconPlay" class="icon icon--md icon-mask icon-mask--play" aria-hidden="true"></span>
        <span id="iconPause" class="icon icon--md icon-mask icon-mask--pause hidden" aria-hidden="true"></span>
      </button>

      <div class="player-time">
        <span id="currentTime">00:00</span> /
        <output id="duration">00:00</output>
      </div>

      <div class="progress" id="progressWrapper">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
      </div>

      <div class="player-stream-controls">
        <select class="select select--quality hidden" id="qualitySelect" title="Video Quality"></select>

        <select class="select select--speed" id="speedSelect" title="Playback Speed">
          <option value="0.5">0.5x</option>
          <option value="0.6">0.6x</option>
          <option value="0.7">0.7x</option>
          <option value="0.8">0.8x</option>
          <option value="0.9">0.9x</option>
          <option value="1" selected>1.0x</option>
          <option value="1.1">1.1x</option>
          <option value="1.2">1.2x</option>
          <option value="1.25">1.25x</option>
          <option value="1.3">1.3x</option>
          <option value="1.4">1.4x</option>
          <option value="1.5">1.5x</option>
          <option value="1.6">1.6x</option>
          <option value="1.7">1.7x</option>
          <option value="1.75">1.75x</option>
          <option value="1.8">1.8x</option>
          <option value="1.9">1.9x</option>
          <option value="2.0">2.0x</option>
          <option value="2.1">2.1x</option>
          <option value="2.2">2.2x</option>
          <option value="2.3">2.3x</option>
          <option value="2.4">2.4x</option>
          <option value="2.5">2.5x</option>
        </select>
      </div>

      <div class="player-tools">
        <div class="volume-control">
          <button class="icon-btn icon-btn--control icon-btn--small" id="muteBtn" type="button">
            <span class="icon icon--md icon-mask icon-mask--volume" aria-hidden="true"></span>
          </button>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1" />
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js"></script>
</body>

</html>
